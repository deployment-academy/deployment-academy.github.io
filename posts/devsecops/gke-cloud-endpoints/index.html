<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Google Cloud Endpoints in GKE with Container-native Load Balancing - Deployment</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Google Cloud Endpoints in GKE walkthrough"><meta property="og:title" content="Google Cloud Endpoints in GKE with Container-native Load Balancing"><meta property="og:description" content="Google Cloud Endpoints in GKE walkthrough"><meta property="og:type" content="article"><meta property="og:url" content="https://deployment.properties/posts/devsecops/gke-cloud-endpoints/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-21T20:28:19-04:00"><meta itemprop=name content="Google Cloud Endpoints in GKE with Container-native Load Balancing"><meta itemprop=description content="Google Cloud Endpoints in GKE walkthrough"><meta itemprop=datePublished content="2021-03-08T00:00:00+00:00"><meta itemprop=dateModified content="2022-05-21T20:28:19-04:00"><meta itemprop=wordCount content="809"><meta itemprop=keywords content="devsecops,kubernetes,gcp,google cloud,gke,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Google Cloud Endpoints in GKE with Container-native Load Balancing"><meta name=twitter:description content="Google Cloud Endpoints in GKE walkthrough"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-0BJEGTESYY"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0BJEGTESYY",{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title=Deployment rel=home><div class="logo__item logo__text"><div class=logo__title>Deployment</div><div class=logo__tagline>A tech blog focused on Software Engineering and DevSecOps</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Google Cloud Endpoints in GKE with Container-native Load Balancing</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>Romulo Santos</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-03-08T00:00:00Z>2021-03-08</time>
<time class=meta__text datetime=2022-05-21T20:28:19-04:00>(Last Modified: 2022-05-21)</time></div></div></header><div class="content post__content clearfix"><p>In the source code for this tutorial, we extend the <a href=https://cloud.google.com/endpoints/docs/openapi/get-started-kubernetes-engine>Getting started with Cloud Endpoints for GKE with ESP</a> documentation guide to provide an example of how to configure HTTPS between the LB and the ESP.</p><p>In the step-by-step below, we will configure the ESP to communicate with the LB over HTTP. I&rsquo;ll let you verify the HTTPS configuration between the ESP and the LB. The purpose of this tutorial is for you to use the existing code in <a href=https://github.com/soeirosantos/cloud-endpoints-gke-container-native-lb>the GitHub repository</a> to make changes and experiment.</p><p>Start cloning the source code.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/soeirosantos/cloud-endpoints-gke-container-native-lb.git
</span></span></code></pre></div><style type=text/css>.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:#444;background:#e7f2fa;text-align:left}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:#fff;background:#6ab0de;text-align:left}.notice.warning .notice-title{background:rgba(217,83,79,.9)}.notice.warning{background:#fae2e2}.notice.info .notice-title{background:#f0b37e}.notice.info{background:#fff2db}.notice.note .notice-title{background:#6ab0de}.notice.note{background:#e7f2fa}.notice.tip .notice-title{background:rgba(92,184,92,.8)}.notice.tip{background:#e6f9e6}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379.0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628.0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628.0l-22.627 22.627c-6.248 6.248-6.248 16.379.0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196.0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627.0 12 5.373 12 12v1e2h12c6.627.0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice note" id=fork><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#note-notice"/></svg></span>Note</p><p>The source code used in the <a href=https://github.com/soeirosantos/cloud-endpoints-gke-container-native-lb>repo for this tutorial</a> is a fork of <a href=github.com/GoogleCloudPlatform/golang-samples/endpoints/getting-started>Google Cloud golang-samples/endpoints/getting-started</a>.</p></div><h2 id=prepare-the-environment>Prepare the environment</h2><p>Create variables with your GCP Project ID, GCP Region and name of the GKE cluster to be created.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcp_project<span style=color:#f92672>=</span>your_project_id
</span></span><span style=display:flex><span>gcp_region<span style=color:#f92672>=</span>us-central1
</span></span><span style=display:flex><span>gke_cluster<span style=color:#f92672>=</span>le-cluster
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud config set project $gcp_project
</span></span></code></pre></div><p>Create the GKE cluster.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud beta container clusters create $gke_cluster <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --release-channel stable <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --enable-ip-alias <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --region $gcp_region
</span></span></code></pre></div><p>After the cluster is created, your <code>kubeconfig</code> is already pointing to the new cluster. If you change contexts and need to re-connect, use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud container clusters get-credentials $gke_cluster --region $gcp_region
</span></span></code></pre></div><p>Create an External IP that will be used in the Ingress later.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud compute addresses create esp-echo --global
</span></span></code></pre></div><p>Store the IP address in a variable.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ingress_ip<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>gcloud compute addresses describe <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    esp-echo --global --format json | jq -r .address<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><h2 id=deploy-the-cloud-endpoints-configuration>Deploy the Cloud Endpoints configuration</h2><p>Inspect the <a href=https://github.com/soeirosantos/cloud-endpoints-gke-container-native-lb/blob/main/openapi.yaml>openapi.yaml</a> file and update the attribute <code>host</code> with the name of your <code>gcp_project</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>host</span>: <span style=color:#e6db74>&#34;echo-api.endpoints.YOUR_PROJECT_ID.cloud.goog&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed -i.original <span style=color:#e6db74>&#34;s/YOUR_PROJECT_ID/</span><span style=color:#e6db74>${</span>gcp_project<span style=color:#e6db74>}</span><span style=color:#e6db74>/g&#34;</span> openapi.yaml
</span></span></code></pre></div><p>The value of the attribute host will be the name of the Cloud Endpoints service.</p><p>Now, upload the configuration and create a managed service.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud endpoints services deploy openapi.yaml
</span></span></code></pre></div><p>Check the Google services enabled in your project and enable the necessary services if they aren&rsquo;t enabled.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud services list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud services enable servicemanagement.googleapis.com
</span></span><span style=display:flex><span>gcloud services enable servicecontrol.googleapis.com
</span></span><span style=display:flex><span>gcloud services enable endpoints.googleapis.com
</span></span><span style=display:flex><span>gcloud services enable echo-api.endpoints.<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>gcp_project<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>.cloud.goog
</span></span></code></pre></div><h2 id=deploy-the-kubernetes-configuration>Deploy the Kubernetes configuration</h2><p>Deploy the Kubernetes config using ESP with HTTP.</p><p>Adjust the name of your Endpoints service in the ESP configuration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>esp</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>gcr.io/endpoints-release/endpoints-runtime:1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>args</span>: [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;--http_port&#34;</span>, <span style=color:#e6db74>&#34;8081&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;--backend&#34;</span>, <span style=color:#e6db74>&#34;127.0.0.1:8080&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;--service&#34;</span>, <span style=color:#e6db74>&#34;echo-api.endpoints.YOUR_PROJECT_ID.cloud.goog&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;--rollout_strategy&#34;</span>, <span style=color:#e6db74>&#34;managed&#34;</span>,
</span></span><span style=display:flex><span>  ]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed -i.original <span style=color:#e6db74>&#34;s/YOUR_PROJECT_ID/</span><span style=color:#e6db74>${</span>gcp_project<span style=color:#e6db74>}</span><span style=color:#e6db74>/g&#34;</span> .kube-http.yaml
</span></span></code></pre></div><p>In the ESP configuration above, the <code>--rollout_strategy=managed</code> option configures ESP to use the latest deployed service configuration. When you specify this option, up to 5 minutes after you deploy a new service configuration, ESP detects the change and automatically begins using it. Alternatively, you can use the <code>--version</code> / <code>-v</code> flag to have more control of which configuration id / version of your Cloud Endpoints the ESP is using. <a href=https://cloud.google.com/endpoints/docs/openapi/specify-proxy-startup-options>See more details about the ESP options</a>. Using the <code>-v</code> flag is recommended for production so you can have control over configuration deployed to prod via Git.</p><p>Deploy the Kubernetes config.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f .kube-http.yaml
</span></span></code></pre></div><p>Check if the pod was properly initialized.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get po
</span></span></code></pre></div><p>Check if the ingress has an external IP assigned. This IP is the same IP we defined earlier.</p><p>It will take several minutes until the Ingress becomes available. Wait until the backend service reports <code>HEALTHY</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>watch <span style=color:#e6db74>&#34;kubectl get ingress esp-echo \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    -o jsonpath=&#39;{.metadata.annotations.ingress\.kubernetes\.io/backends}&#39;&#34;</span>
</span></span></code></pre></div><p>Use the following commands to observe how the GCP Backend Service and Health Check get configured based on your Ingress, Service and Pod configuration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>backend_service<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get ingress esp-echo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.metadata.annotations.ingress\.kubernetes\.io/backends}&#39;</span> | jq -r keys<span style=color:#f92672>[</span>0<span style=color:#f92672>]</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud compute backend-services describe $backend_service --global
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud compute health-checks describe $backend_service --global
</span></span></code></pre></div><p>Finally, check your service.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -v http://<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>ingress_ip<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>/healthz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl --request POST <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>   --header <span style=color:#e6db74>&#34;content-type:application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>   --data <span style=color:#e6db74>&#39;{&#34;message&#34;:&#34;hello world&#34;}&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>   <span style=color:#e6db74>&#34;http://</span><span style=color:#e6db74>${</span>ingress_ip<span style=color:#e6db74>}</span><span style=color:#e6db74>/echo&#34;</span>
</span></span></code></pre></div><p>Execute the same steps with the <a href=https://github.com/soeirosantos/cloud-endpoints-gke-container-native-lb/blob/main/.kube-https.yaml>.kube-https.yaml</a> configuration. Notice that you will test from the <code>ingress_ip</code> still using HTTP. This is because when you configure the ESP container with HTTPS you are using TLS only for traffic from <code>LB -> ESP</code>. Configuring TLS for your Ingress is important and something you should definitely do, but it&rsquo;s out of the scope in this tutorial.</p><h2 id=optional---test-different-types-of-security-definitions>Optional - Test different types of Security Definitions</h2><p>The Open API configuration provides examples of how to configure different types of <code>securityDefinitions</code> using Cloud Endpoints. These <code>securityDefinitions</code> after proper configured can be tested with <a href=https://github.com/soeirosantos/cloud-endpoints-gke-container-native-lb/blob/main/client/main.go>this client</a>.</p><h2 id=clean-up>Clean up</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete -f .kube-http.yaml
</span></span><span style=display:flex><span>gcloud services disable echo-api.endpoints.<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>gcp_project<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>.cloud.goog
</span></span><span style=display:flex><span>gcloud endpoints services delete echo-api.endpoints.<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>gcp_project<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>.cloud.goog
</span></span><span style=display:flex><span>gcloud compute addresses delete esp-echo --global
</span></span><span style=display:flex><span>gcloud container clusters delete <span style=color:#e6db74>&#34;</span>$gke_cluster<span style=color:#e6db74>&#34;</span> --region <span style=color:#e6db74>&#34;</span>$gcp_region<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h2 id=troubleshooting>Troubleshooting</h2><p>The main problems you may have in this setup are related to the Ingress configuration. You can check the Google Cloud <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/container-native-load-balancing#troubleshooting>troubleshooting page</a> for Container-native load balancing.</p><p>If the Ingress health check for the https example is consistently showing Unhealthy you may need to create a firewall rule to allow the Google LB to reach the backend in the 8443 port used in this example.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud compute firewall-rules create fw-allow-health-check-and-proxy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --network<span style=color:#f92672>=</span>NETWORK_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --action<span style=color:#f92672>=</span>allow <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --direction<span style=color:#f92672>=</span>ingress <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --target-tags<span style=color:#f92672>=</span>GKE_NODE_NETWORK_TAGS <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --source-ranges<span style=color:#f92672>=</span>130.211.0.0/22,35.191.0.0/16 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --rules<span style=color:#f92672>=</span>tcp:8443
</span></span></code></pre></div><h2 id=references>References</h2><p>Resources that helped me during this experiment:</p><p><a href=https://cloud.google.com/endpoints/docs/openapi/get-started-kubernetes-engine>https://cloud.google.com/endpoints/docs/openapi/get-started-kubernetes-engine</a>
<a href=https://cloud.google.com/endpoints/docs/openapi/specify-proxy-startup-options>https://cloud.google.com/endpoints/docs/openapi/specify-proxy-startup-options</a>
<a href=https://cloud.google.com/endpoints/docs/openapi/configure-endpoints>https://cloud.google.com/endpoints/docs/openapi/configure-endpoints</a>
<a href=https://cloud.google.com/kubernetes-engine/docs/concepts/ingress-xlb#https_tls_between_load_balancer_and_your_application>https://cloud.google.com/kubernetes-engine/docs/concepts/ingress-xlb#https_tls_between_load_balancer_and_your_application</a>
<a href=https://cloud.google.com/kubernetes-engine/docs/concepts/container-native-load-balancing>https://cloud.google.com/kubernetes-engine/docs/concepts/container-native-load-balancing</a>
<a href=https://cloud.google.com/kubernetes-engine/docs/how-to/container-native-load-balancing#troubleshooting>https://cloud.google.com/kubernetes-engine/docs/how-to/container-native-load-balancing#troubleshooting</a></p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/devsecops/ rel=tag>devsecops</a></li><li class=tags__item><a class="tags__link btn" href=/tags/kubernetes/ rel=tag>kubernetes</a></li><li class=tags__item><a class="tags__link btn" href=/tags/gcp/ rel=tag>gcp</a></li><li class=tags__item><a class="tags__link btn" href=/tags/google-cloud/ rel=tag>google cloud</a></li><li class=tags__item><a class="tags__link btn" href=/tags/gke/ rel=tag>gke</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 Deployment - A tech blog focused on Software Engineering and DevSecOps.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script>
<script src=/js/custom.js></script></body></html>